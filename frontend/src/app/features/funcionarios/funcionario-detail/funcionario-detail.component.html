<div class="detail-container">
  <!-- Loading State -->
  @if (loading()) {
  <div class="loading-container">
    <div class="spinner"></div>
    <p>Carregando dados do funcion√°rio...</p>
  </div>
  }

  <!-- Error State -->
  @if (error()) {
  <div class="error-container">
    <svg width="64" height="64" viewBox="0 0 20 20" fill="currentColor">
      <path
        fill-rule="evenodd"
        d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z"
        clip-rule="evenodd"
      />
    </svg>
    <h3>{{ error() }}</h3>
    <a [routerLink]="['/funcionarios']" class="btn-back">‚Üê Voltar para lista</a>
  </div>
  }

  <!-- Content -->
  @if (!loading() && !error() && funcionario()) {

  <!-- Header -->
  <header class="detail-header">
    <div class="header-top">
      <a [routerLink]="['/funcionarios']" class="btn-back">‚Üê Voltar</a>
      <div class="header-actions">
        <a [routerLink]="['/funcionarios', funcionario()!.id, 'editar']" class="btn-edit">‚úèÔ∏è Editar</a>
      </div>
    </div>

    <div class="header-content">
      <div class="header-info">
        <h1>{{ funcionario()!.nome }}</h1>
        <div class="header-meta">
          <span class="meta-item">
            <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
              <path
                fill-rule="evenodd"
                d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z"
                clip-rule="evenodd"
              />
            </svg>
            CPF: {{ funcionario()!.cpf }}
          </span>
          <span class="meta-item">
            <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
              <path d="M2 3a1 1 0 011-1h2.153a1 1 0 01.986.836l.74 4.435a1 1 0 01-.54 1.06l-1.548.773a11.037 11.037 0 006.105 6.105l.774-1.548a1 1 0 011.059-.54l4.435.74a1 1 0 01.836.986V17a1 1 0 01-1 1h-2C7.82 18 2 12.18 2 5V3z" />
            </svg>
            {{ funcionario()!.celular }}
          </span>
          @if (condominio()) {
          <span class="meta-item">
            <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
              <path
                fill-rule="evenodd"
                d="M4 4a2 2 0 012-2h8a2 2 0 012 2v12a1 1 0 110 2h-3a1 1 0 01-1-1v-2a1 1 0 00-1-1H9a1 1 0 00-1 1v2a1 1 0 01-1 1H4a1 1 0 110-2V4zm3 1h2v2H7V5zm2 4H7v2h2V9zm2-4h2v2h-2V5zm2 4h-2v2h2V9z"
                clip-rule="evenodd"
              />
            </svg>
            {{ condominio()!.nome }}
          </span>
          }
        </div>
      </div>
    </div>
  </header>

  <!-- M√©tricas -->
  <section class="metrics-section">
    <h2 class="section-title">üìä M√©tricas de Desempenho</h2>
    <div class="metrics-grid">
      <div class="metric-card">
        <div class="metric-icon">üìÖ</div>
        <div class="metric-content">
          <span class="metric-label">Total de Aloca√ß√µes</span>
          <span class="metric-value">{{ totalAlocacoes() }}</span>
        </div>
      </div>

      <div class="metric-card">
        <div class="metric-icon">‚úÖ</div>
        <div class="metric-content">
          <span class="metric-label">Aloca√ß√µes Confirmadas</span>
          <span class="metric-value">{{ alocacoesConfirmadas() }}</span>
        </div>
      </div>

      <div class="metric-card">
        <div class="metric-icon">‚ö†Ô∏è</div>
        <div class="metric-content">
          <span class="metric-label">Faltas Registradas</span>
          <span class="metric-value alert">{{ totalFaltas() }}</span>
        </div>
      </div>

      <div class="metric-card">
        <div class="metric-icon">üìà</div>
        <div class="metric-content">
          <span class="metric-label">Taxa de Presen√ßa</span>
          <span class="metric-value">{{ taxaPresenca() | number : '1.1-1' }}%</span>
        </div>
      </div>

      <div class="metric-card">
        <div class="metric-icon">üí∏</div>
        <div class="metric-content">
          <span class="metric-label">Preju√≠zo por Faltas</span>
          <span class="metric-value danger">{{ formatCurrency(prejuizoPorFaltas()) }}</span>
        </div>
      </div>

      @if (contrato()) {
      <div class="metric-card">
        <div class="metric-icon">üíµ</div>
        <div class="metric-content">
          <span class="metric-label">Sal√°rio Total</span>
          <span class="metric-value">{{ formatCurrency(funcionario()!.salarioTotal || 0) }}</span>
        </div>
      </div>
      }
    </div>
  </section>

  <!-- Aloca√ß√µes por Posto -->
  @if (alocacoesPorPosto().length > 0) {
  <section class="postos-section">
    <h2 class="section-title">üìç Aloca√ß√µes por Posto de Trabalho</h2>
    <div class="postos-grid">
      @for (item of alocacoesPorPosto(); track item.posto.id) {
      <div class="posto-card">
        <div class="posto-header">
          <span class="posto-horario">{{ getPostoNome(item.posto.id) }}</span>
          <span class="posto-total">{{ item.total }} aloca√ß√µes</span>
        </div>
      </div>
      }
    </div>
  </section>
  }

  <!-- Hist√≥rico de Aloca√ß√µes -->
  <section class="alocacoes-section">
    <h2 class="section-title">üìã Hist√≥rico de Aloca√ß√µes</h2>

    @if (alocacoes().length === 0) {
    <div class="empty-state">
      <svg width="64" height="64" viewBox="0 0 20 20" fill="currentColor">
        <path
          fill-rule="evenodd"
          d="M3 3a1 1 0 011-1h12a1 1 0 011 1v12a1 1 0 01-1 1H4a1 1 0 01-1-1V3zm7 8a1 1 0 000 2h3a1 1 0 000-2h-3z"
          clip-rule="evenodd"
        />
      </svg>
      <p>Nenhuma aloca√ß√£o encontrada</p>
    </div>
    } @else {
    <div class="table-container">
      <table class="alocacoes-table">
        <thead>
          <tr>
            <th>Data</th>
            <th>Posto de Trabalho</th>
            <th>Status</th>
            <th>Tipo</th>
          </tr>
        </thead>
        <tbody>
          @for (alocacao of alocacoes(); track alocacao.id) {
          <tr>
            <td>{{ formatDate(alocacao.data) }}</td>
            <td>{{ getPostoNome(alocacao.postoDeTrabalhoId) }}</td>
            <td>
              <span [class]="'badge ' + getStatusBadgeClass(alocacao.statusAlocacao)">
                {{ getStatusLabel(alocacao.statusAlocacao) }}
              </span>
            </td>
            <td>{{ alocacao.tipoAlocacao }}</td>
          </tr>
          }
        </tbody>
      </table>
    </div>
    }
  </section>

  <!-- Detalhes de Faltas -->
  @if (totalFaltas() > 0) {
  <section class="faltas-section">
    <h2 class="section-title">‚ö†Ô∏è Detalhamento de Faltas</h2>
    <div class="faltas-container">
      <div class="faltas-summary">
        <div class="summary-card">
          <h3>Resumo Financeiro de Faltas</h3>
          <div class="summary-content">
            <div class="summary-item">
              <span class="summary-label">Total de Faltas:</span>
              <span class="summary-value">{{ totalFaltas() }}</span>
            </div>
            @if (contrato()) {
            <div class="summary-item">
              <span class="summary-label">Valor da Di√°ria:</span>
              <span class="summary-value">{{ formatCurrency(contrato()!.valorDiariaCobrada) }}</span>
            </div>
            <div class="summary-item total">
              <span class="summary-label">Preju√≠zo Total:</span>
              <span class="summary-value danger">{{ formatCurrency(prejuizoPorFaltas()) }}</span>
            </div>
            }
          </div>
        </div>
      </div>

      <div class="faltas-list">
        <h4>Hist√≥rico de Faltas</h4>
        @for (falta of faltas(); track falta.id) {
        <div class="falta-item">
          <div class="falta-date">{{ formatDate(falta.data) }}</div>
          <div class="falta-posto">{{ getPostoNome(falta.postoDeTrabalhoId) }}</div>
          @if (contrato()) {
          <div class="falta-valor">{{ formatCurrency(contrato()!.valorDiariaCobrada) }}</div>
          }
        </div>
        }
      </div>
    </div>
  </section>
  }

  }
</div>


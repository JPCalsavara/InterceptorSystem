<div class="page-container">
  <div class="page-header">
    <div class="header-content">
      <button class="btn-back" routerLink="/contratos">
        <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
          <path
            fill-rule="evenodd"
            d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z"
            clip-rule="evenodd"
          />
        </svg>
        Voltar
      </button>
      <h1>{{ isEdit() ? '✏️ Editar Contrato' : '➕ Novo Contrato' }}</h1>
      <p class="subtitle">
        {{
          isEdit()
            ? 'Atualize as informações do contrato'
            : 'Preencha os dados para cadastrar um novo contrato'
        }}
      </p>
    </div>
  </div>

  @if (error()) {
  <div class="alert alert-error">
    <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
      <path
        fill-rule="evenodd"
        d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z"
        clip-rule="evenodd"
      />
    </svg>
    {{ error() }}
  </div>
  }

  <form [formGroup]="form" (ngSubmit)="onSubmit()" class="form-container">
    <div class="form-card">
      <div class="form-group">
        <label for="condominioId" class="form-label">
          Condomínio <span class="required">*</span>
        </label>
        <select
          id="condominioId"
          formControlName="condominioId"
          class="form-input"
          [class.error]="hasError('condominioId')"
          [disabled]="isEdit()"
        >
          <option value="">Selecione um condomínio</option>
          @for (cond of condominios(); track cond.id) {
          <option [value]="cond.id">{{ cond.nome }}</option>
          }
        </select>
        @if (hasError('condominioId')) {
        <span class="error-message">{{ getErrorMessage('condominioId') }}</span>
        }
      </div>

      <div class="form-group">
        <label for="descricao" class="form-label">
          Descrição <span class="required">*</span>
        </label>
        <textarea
          id="descricao"
          formControlName="descricao"
          class="form-input"
          [class.error]="hasError('descricao')"
          rows="3"
          placeholder="Ex: Contrato de prestação de serviços de vigilância"
        >
        </textarea>
        @if (hasError('descricao')) {
        <span class="error-message">{{ getErrorMessage('descricao') }}</span>
        }
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="valorTotal" class="form-label">
            Valor Total <span class="required">*</span>
          </label>
          <input
            id="valorTotal"
            type="number"
            formControlName="valorTotal"
            class="form-input"
            [class.error]="hasError('valorTotal')"
            placeholder="0.00"
            step="0.01"
          />
          @if (hasError('valorTotal')) {
          <span class="error-message">{{ getErrorMessage('valorTotal') }}</span>
          }
        </div>

        <div class="form-group">
          <label for="valorDiariaCobrada" class="form-label">
            Valor Diária <span class="required">*</span>
          </label>
          <input
            id="valorDiariaCobrada"
            type="number"
            formControlName="valorDiariaCobrada"
            class="form-input"
            [class.error]="hasError('valorDiariaCobrada')"
            placeholder="0.00"
            step="0.01"
          />
          @if (hasError('valorDiariaCobrada')) {
          <span class="error-message">{{ getErrorMessage('valorDiariaCobrada') }}</span>
          }
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="dataInicio" class="form-label">
            Data Início <span class="required">*</span>
          </label>
          <input
            id="dataInicio"
            type="date"
            formControlName="dataInicio"
            class="form-input"
            [class.error]="hasError('dataInicio')"
          />
          @if (hasError('dataInicio')) {
          <span class="error-message">{{ getErrorMessage('dataInicio') }}</span>
          }
        </div>

        <div class="form-group">
          <label for="dataFim" class="form-label"> Data Fim <span class="required">*</span> </label>
          <input
            id="dataFim"
            type="date"
            formControlName="dataFim"
            class="form-input"
            [class.error]="hasError('dataFim')"
          />
          @if (hasError('dataFim')) {
          <span class="error-message">{{ getErrorMessage('dataFim') }}</span>
          }
        </div>
      </div>

      <div class="form-group">
        <label for="status" class="form-label"> Status <span class="required">*</span> </label>
        <select
          id="status"
          formControlName="status"
          class="form-input"
          [class.error]="hasError('status')"
        >
          @for (opt of statusOptions; track opt.value) {
          <option [value]="opt.value">{{ opt.label }}</option>
          }
        </select>
        @if (hasError('status')) {
        <span class="error-message">{{ getErrorMessage('status') }}</span>
        }
      </div>

      <div class="form-footer">
        <p class="required-note"><span class="required">*</span> Campos obrigatórios</p>
        <div class="button-group">
          <button type="button" class="btn-secondary" (click)="cancel()" [disabled]="loading()">
            Cancelar
          </button>
          <button type="submit" class="btn-primary" [disabled]="loading()">
            @if (loading()) {
            <span class="spinner-small"></span>
            Salvando... } @else {
            {{ isEdit() ? 'Atualizar' : 'Cadastrar' }}
            }
          </button>
        </div>
      </div>
    </div>
  </form>
</div>
